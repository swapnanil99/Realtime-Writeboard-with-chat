<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Realtime Whiteboard + Chat</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #e9ecef;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  .toolbar {
    background: white;
    padding: 10px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  canvas {
    flex: 1;
    border: 2px solid #444;
    border-radius: 8px;
    margin: 10px;
    background: white;
    touch-action: none;
  }

  .chat-container {
    background: white;
    border-radius: 8px;
    margin: 10px;
    padding: 10px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    height: 200px;
  }

  .messages {
    flex: 1;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 8px;
    margin-bottom: 10px;
    background: #f8f9fa;
  }

  .input-area {
    display: flex;
    gap: 8px;
  }

  input[type="text"] {
    flex: 1;
    padding: 8px;
    border: 1px solid #bbb;
    border-radius: 5px;
  }

  button {
    background: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 8px 12px;
    cursor: pointer;
  }

  button:hover {
    background: #0056b3;
  }

  @media (max-height: 700px) {
    .chat-container {
      height: 160px;
    }
  }

  @media (max-width: 600px) {
    .toolbar {
      flex-direction: column;
    }
    canvas {
      height: 300px;
    }
  }
</style>
</head>
<body>
  <div class="toolbar">
    <label>Color:</label>
    <input type="color" id="colorPicker" value="#000000">
    <label>Width:</label>
    <input type="range" id="widthRange" min="1" max="20" value="3">
    <button id="undoBtn">Undo</button>
    <button id="redoBtn">Redo</button>
    <button id="eraserBtn">Eraser</button>
    <button id="clearBtn">Clear</button>
    <button id="saveBtn">Save</button>
  </div>

  <canvas id="board"></canvas>

  <div class="chat-container">
    <div class="messages" id="messages"></div>
    <div class="input-area">
      <input type="text" id="messageInput" placeholder="Type a message...">
      <button id="sendBtn">Send</button>
    </div>
  </div>

<script>
const canvas = document.getElementById("board");
const ctx = canvas.getContext("2d");
const messages = document.getElementById("messages");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
let drawing = false, currentPath = [], undoStack = [], redoStack = [];

function resizeCanvas() {
  canvas.width = window.innerWidth - 20;
  canvas.height = window.innerHeight * 0.5;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

canvas.addEventListener("mousedown", start);
canvas.addEventListener("mouseup", stop);
canvas.addEventListener("mousemove", draw);

canvas.addEventListener("touchstart", e => start(e.touches[0]));
canvas.addEventListener("touchend", stop);
canvas.addEventListener("touchmove", e => draw(e.touches[0]));

function start(e) {
  drawing = true;
  currentPath = [];
  draw(e);
}

function stop() {
  if (!drawing) return;
  drawing = false;
  undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
  redoStack = [];
}

function draw(e) {
  if (!drawing) return;
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  currentPath.push({x, y});
  ctx.lineWidth = document.getElementById("widthRange").value;
  ctx.lineCap = "round";
  ctx.strokeStyle = document.getElementById("colorPicker").value;
  ctx.beginPath();
  const prev = currentPath[currentPath.length - 2];
  if (prev) ctx.moveTo(prev.x, prev.y);
  ctx.lineTo(x, y);
  ctx.stroke();
}

document.getElementById("clearBtn").onclick = () => ctx.clearRect(0, 0, canvas.width, canvas.height);
document.getElementById("eraserBtn").onclick = () => ctx.strokeStyle = "#FFFFFF";
document.getElementById("undoBtn").onclick = () => {
  if (undoStack.length > 0) {
    redoStack.push(undoStack.pop());
    const imageData = undoStack[undoStack.length - 1];
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (imageData) ctx.putImageData(imageData, 0, 0);
  }
};
document.getElementById("redoBtn").onclick = () => {
  if (redoStack.length > 0) {
    const imageData = redoStack.pop();
    undoStack.push(imageData);
    ctx.putImageData(imageData, 0, 0);
  }
};
document.getElementById("saveBtn").onclick = () => {
  const link = document.createElement("a");
  link.download = "whiteboard.png";
  link.href = canvas.toDataURL();
  link.click();
};

// Chat functionality (local)
sendBtn.onclick = () => {
  const text = messageInput.value.trim();
  if (!text) return;
  const div = document.createElement("div");
  div.textContent = "You: " + text;
  messages.appendChild(div);
  messageInput.value = "";
  messages.scrollTop = messages.scrollHeight;
};
</script>
</body>
</html>
